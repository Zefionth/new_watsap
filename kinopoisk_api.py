import requests
from config import KINOPOISK_API_TOKEN

def get_info_movies(name: str) -> str:
    """–ü–æ–ª—É—á–∞–µ—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å–º–µ –ø–æ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—é.

    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        name (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∏–ª—å–º–µ –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
    """
    # –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è API –ö–∏–Ω–æ–ü–æ–∏—Å–∫ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ–∏–ª—å–º–∞
    url = f"https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword={name}"
    headers = {
        'X-API-KEY': KINOPOISK_API_TOKEN  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å API –∫–ª—é—á–æ–º
    }
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º GET-–∑–∞–ø—Ä–æ—Å –∫ API
    response = requests.get(url, headers=headers)

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
    data = response.json()
    films = data.get('films', [])  # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤

    if films:
        film = films[0]  # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º –∏–∑ —Å–ø–∏—Å–∫–∞
        name = film.get('nameRu')  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
        year = film.get('year', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')  # –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ —Ñ–∏–ª—å–º–∞
        imageUrl = film.get('posterUrl')  # URL –ø–æ—Å—Ç–µ—Ä–∞ —Ñ–∏–ª—å–º–∞
        rating = film.get('rating')  # –†–µ–π—Ç–∏–Ω–≥ —Ñ–∏–ª—å–º–∞
        description = film.get('description', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')  # –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ —Ä–µ–π—Ç–∏–Ω–≥ —Ä–∞–≤–µ–Ω 'null'
        if rating == 'null':
            rating = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'

        if name:
            return (
                f"{name}({year})\n"
                f"‚≠ê–†–µ–π—Ç–∏–Ω–≥: {rating}\n"
                f"üìÑ–û–ø–∏—Å–∞–Ω–∏–µ: {description}\n"
                f"üñºÔ∏è–ü–æ—Å—Ç–µ—Ä: {imageUrl}\n"
            )
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º None, –µ—Å–ª–∏ —Ñ–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    return None
